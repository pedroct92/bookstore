function loadNewItem(){resetFields()}function loadEditItem(e){client.book.read(e).done(function(t){loadFields(t),null!=t.cover&&loadSavedFileToDropzone(e)}).fail(function(e,t){nofityError(e)})}function createItem(e){client.book.create(e).done(function(e){unloadForm(),nofityAction("success","Book was successfully created!")}).fail(function(e,t){nofityError(e)})}function updateItem(e,t){client.book.update(e,t).done(function(e){unloadForm(),nofityAction("success","Book was successfully edited!")}).fail(function(e,t){nofityError(e)})}function deleteItem(e){client.book.del(e).done(function(e){table.ajax.reload(),nofityAction("success","Book was successfully deleted!")}).fail(function(e,t){nofityError(e)})}function validateForm(e){var t="";return""==e.title.trim()&&(t+="<li> Title is required. </li>"),""==e.author.trim()&&(t+="<li> Author is required. </li>"),""==e.numPages.trim()&&(t+="<li> Pages is required. </li>"),0==Dropzone.forElement("#file-form").files.length&&(t+=" <li> Cover is required. </li>"),""!=t?(notifyValidation(t),!1):($.notifyClose(),!0)}function notifyValidation(e){$.notifyClose(),$.notify({title:"<strong>Please, check missing fields:</strong> <br>",message:"<ul>"+e+"</ul>"},{type:"danger",z_index:9999999,delay:0,newest_on_top:!0})}function nofityAction(e,t){$.notify({title:"<strong> Status: </strong>",message:t},{type:e,z_index:9999999,newest_on_top:!0})}function nofityError(e){$.notify({title:"<strong> Status: </strong>",message:jQuery.parseJSON(e.responseText).message},{z_index:9999999,type:"danger"})}function loadSavedFileToDropzone(e){var t={name:"Cover",size:1e3,status:"success",accepted:!0},o=Dropzone.forElement("#file-form");o.emit("addedfile",t),o.files.push(t),o.createThumbnailFromUrl(t,"/book/"+e+"/img/"),o.emit("complete",t),o.options.maxFiles=1}function resetFields(){$("#id").val(""),$("#title").val(""),$("#author").val(""),$("#numPages").val(""),$("#description").val(""),$("#id_base64_data").val("")}function loadFields(e){$("#id").val(e.id),$("#title").val(e.title),$("#author").val(e.author),$("#numPages").val(e.numPages),$("#description").val(e.description),$("#id_base64_data").val(e.cover)}function unloadForm(){$("#myModal").modal("toggle"),Dropzone.forElement("#file-form").removeAllFiles(!0),table.ajax.reload(),resetFields()}function buildJson(){var e={title:$("#title").val(),author:$("#author").val(),numPages:$("#numPages").val(),description:$("#description").val(),cover:$("#id_base64_data").val()};return e}function openImg(e){$("#coverImg").attr("src",e)}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}var client=new $.RestClient("/");client.add("book",{stringifyData:!0}),Dropzone.autoDiscover=!1;var myDropzone=$("#file-form").dropzone({paramName:"file",clickable:!0,maxFilesize:2,addRemoveLinks:!0,maxFiles:1,acceptedFiles:"image/jpeg,image/png",uploadMultiple:!1,autoProcessQueue:!1,init:function(){$("#close, #close-top").click(function(){Dropzone.forElement("#file-form").removeAllFiles(!0),$.notifyClose()}),this.on("maxfilesexceeded",function(e){this.removeAllFiles(!0),this.addFile(e)})},accept:function(e,t){function o(t){document.getElementById("id_base64_data").setAttribute("value",t.target.result),document.getElementById("id_base64_name").setAttribute("value",e.name),document.getElementById("id_base64_content_type").setAttribute("value",e.type)}reader=new FileReader,reader.onload=o,reader.readAsDataURL(e),t()}}),table=$("#example").DataTable({ajax:"/book",lengthMenu:[[5,10,15,25,50,-1],[5,10,15,25,50,"All"]],columns:[{data:"id"},{data:"title"},{data:"author"},{data:"numPages"},{data:"cover"},{data:"id"}],columnDefs:[{orderable:!1,targets:[4,5]}],fnCreatedRow:function(e,t,o){$("td:eq(4)",e).html('<a href="" onclick="openImg(\''+t.cover+'\')" data-toggle="modal" data-target="#imgModal"><img src="'+t.cover+'" class="img-rounded img-size-30-30"></a>'),$("td:eq(5)",e).html('<button type="button" onclick="loadEditItem('+t.id+')" class="btn btn-default" data-toggle="modal" data-target="#myModal" title="Edit"><span class="glyphicon glyphicon glyphicon-pencil"></span></button>').append('<button type="button" onclick="deleteItem('+t.id+')" class="btn btn-default" title="Delete"><span class="glyphicon glyphicon glyphicon-trash"></span></button>')}});$(document).ready(function(){$("#save").click(saveForm),$('<a class="btn btn-primary btn-primary btn-custom" data-toggle="modal" data-target="#myModal" onclick="loadNewItem()">Add New</a>').appendTo("div.dataTables_filter"),$("#numPages").keyup(function(e){/\D/g.test(this.value)&&(this.value=this.value.replace(/\D/g,""))})});var saveForm=function(){var e=$("#id").val(),t=buildJson();validateForm(t)&&(isNumber(e)?updateItem(e,t):createItem(t))};